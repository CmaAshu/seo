<!DOCTYPE html>
<html lang="en" class="scrollbar-gutter-stable" data-theme="light">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FLGRHV6077"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FLGRHV6077');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#6366f1">
    
    <!-- DYNAMIC SEO META TAGS - SYLLABUS 2022 COMPLIANT -->
    <title>CMA Paper 7 MCQ Quiz - Direct & Indirect Taxation Practice | Prepogy</title>
    <meta name="description" content="Free Online ICMAI CMA Paper 7 (Direct & Indirect Taxation) MCQ Quiz. Practice the 2024-25 syllabus with instant results and detailed explanations. Perfect for CMA Intermediate Group I aspirants on Prepogy.">
    <meta name="keywords" content="CMA Paper 7 MCQ, Direct & Indirect Taxation MCQ, ICMAI MCQ Practice, Prepogy CMA, CMA Intermediate Paper 7 Online Test, CMA 2024-25 Syllabus MCQs">
    <link rel="canonical" href="https://prepogy.com/paper7-MCQ.html">

    <!-- SOCIAL MEDIA (OG TAGS) -->
    <meta property="og:title" content="CMA Paper 7 (Direct & Indirect Taxation) MCQ Quiz - Prepogy">
    <meta property="og:description" content="Master CMA Intermediate Paper 7 with our free online MCQ quiz. Get instant feedback, accuracy tracking, and taxation law explanations.">
    <meta property="og:image" content="https://prepogy.com/og-image-paper7.png">
    <meta property="og:url" content="https://prepogy.com/paper7-MCQ.html">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CMA Paper 7 Direct & Indirect Taxation Practice">
    <meta name="twitter:description" content="Prepogy's free online quiz for CMA Intermediate Paper 7. Instant results for the latest ICMAI syllabus.">

    <!-- STRUCTURED DATA (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Quiz",
      "name": "CMA Paper 7 (Direct & Indirect Taxation) MCQ Practice Quiz",
      "description": "Comprehensive practice quiz for CMA Intermediate Paper 7 (Direct & Indirect Taxation) featuring questions based on the 2024-25 ICMAI syllabus.",
      "educationalAlignment": [
        {
          "@type": "AlignmentObject",
          "alignmentType": "educationalLevel",
          "educationalFramework": "ICMAI",
          "targetName": "CMA Intermediate"
        }
      ],
      "hasPart": {
        "@type": "Question",
        "eduQuestionType": "Multiple choice"
      }
    }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Link to external Question Database -->
    <script src="sw7.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'] },
                    colors: {
                        primary: { DEFAULT: '#6366f1', dark: '#4f46e5' },
                        success: '#10b981', 
                        error: '#ef4444', 
                        surface: 'var(--color-surface)',
                    },
                    boxShadow: {
                        soft: '0 10px 40px -10px rgba(0,0,0,0.06)',
                        hover: '0 20px 40px -5px rgba(99, 102, 241, 0.12)',
                        'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.05)',
                    },
                    animation: {
                        'rise': 'rise 20s linear infinite',
                        'floating': 'floating 4s ease-in-out infinite',
                        'fade-in-up': 'fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'slide-in': 'slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pop': 'pop 0.3s ease-out forwards',
                        'rotate-border': 'rotate-border 3s linear infinite',
                        'confetti-fall': 'confetti-fall 3s linear forwards',
                    },
                    keyframes: {
                        rise: { '0%': { transform: 'translateY(0) rotate(0deg)', opacity: '0.8' }, '80%': { opacity: '0.4' }, '100%': { transform: 'translateY(-125vh) rotate(360deg)', opacity: '0' } },
                        floating: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-12px)' } },
                        fadeInUp: { 'from': { opacity: '0', transform: 'translateY(20px)' }, 'to': { opacity: '1', transform: 'translateY(0)' } },
                        slideIn: { 'from': { opacity: '0', transform: 'translateX(30px)' }, 'to': { opacity: '1', transform: 'translateX(0)' } },
                        pop: { '0%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.03)' }, '100%': { transform: 'scale(1)' } },
                        'rotate-border': { 'from': { transform: 'rotate(0deg)' }, 'to': { transform: 'rotate(360deg)' } },
                        'confetti-fall': { '0%': { transform: 'translateY(-20px) rotate(0deg)', opacity: '1' }, '100%': { transform: 'translateY(100vh) rotate(720deg)', opacity: '0' } },
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        :root {
            --color-bg: #f8fafc;
            --color-surface: #ffffff;
            --color-text-main: #1e293b;
            --color-text-muted: #64748b;
            --color-border: #e2e8f0;
        }

        [data-theme="dark"] {
            --color-bg: #0f172a;
            --color-surface: #1e293b;
            --color-text-main: #f1f5f9;
            --color-text-muted: #94a3b8;
            --color-border: #334155;
        }

        [data-theme="sepia"] {
            --color-bg: #fdf6e3;
            --color-surface: #f5eacf;
            --color-text-main: #586e75;
            --color-text-muted: #839496;
            --color-border: #ddd6c1;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text-main);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        @layer utilities {
            .google-g-text {
                background: conic-gradient(#4285f4 0deg 90deg, #34a853 90deg 180deg, #fbbc05 180deg 270deg, #ea4335 270deg 360deg);
                -webkit-background-clip: text; -webkit-text-fill-color: transparent; @apply font-black;
            }
        }

        @layer components {
            .option {
                @apply flex items-center p-4 md:p-6 mb-4 rounded-2xl border cursor-pointer transition-all duration-300;
                background-color: var(--color-surface);
                border-color: var(--color-border);
            }
            .option:not(.disabled):hover {
                @apply shadow-hover -translate-y-1;
                border-color: #6366f1;
            }
            .option.disabled { @apply cursor-default opacity-80; }
            .option.correct { 
                @apply border-success ring-2 ring-success/20; 
                background-color: rgba(16, 185, 129, 0.1);
            }
            .option.incorrect { 
                @apply border-error ring-2 ring-error/20;
                background-color: rgba(239, 68, 68, 0.1);
            }
            .btn-home {
                @apply px-5 py-2.5 rounded-full shadow-sm font-bold text-xs transition-all duration-300 flex items-center gap-2 active:scale-95;
                background-color: var(--color-surface);
                border: 1px solid var(--color-border);
                color: var(--color-text-muted);
            }
            .btn-home:hover {
                @apply shadow-md text-primary;
                border-color: #6366f1;
            }
            .theme-btn {
                @apply w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-200;
                background-color: var(--color-surface);
                border: 1px solid var(--color-border);
            }
            .theme-btn.active {
                @apply border-primary text-primary ring-2 ring-primary/20;
            }
            .confetti-particle { @apply fixed top-[-20px] pointer-events-none z-[9999] animate-confetti-fall; }
            
            .share-btn {
                @apply flex items-center justify-center gap-2 py-4 px-6 rounded-2xl font-bold text-sm text-white shadow-lg transition-all duration-300 hover:scale-[1.02] active:scale-95;
            }

            .breadcrumb {
                @apply flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-4;
            }
        }
    </style>
</head>
<body class="font-sans overflow-x-hidden antialiased min-h-screen flex flex-col">

    <!-- Background Shapes -->
    <div class="fixed inset-0 w-full h-full pointer-events-none -z-10 overflow-hidden select-none opacity-40">
        <div class="absolute bottom-[-150px] left-[5%] text-[55px] text-emerald-500 animate-rise" style="animation-duration: 22s;">â‚¹</div>
        <div class="absolute bottom-[-150px] left-[15%] text-[45px] text-rose-500 animate-rise" style="animation-duration: 25s;">â‚¬</div>
        <div class="absolute bottom-[-150px] left-[25%] text-[60px] text-blue-500 animate-rise" style="animation-duration: 18s;">Â£</div>
        <div class="absolute bottom-[-150px] left-[40%] text-[50px] text-amber-500 animate-rise" style="animation-duration: 20s;">$</div>
        <div class="absolute bottom-[-150px] left-[55%] text-[55px] text-indigo-500 animate-rise" style="animation-duration: 28s;">Â¥</div>
        <div class="absolute bottom-[-150px] left-[70%] text-[40px] text-cyan-500 animate-rise" style="animation-duration: 24s;">à¸¿</div>
        <div class="absolute bottom-[-150px] left-[85%] text-[65px] text-purple-500 animate-rise" style="animation-duration: 30s;">â‚©</div>
        <div class="absolute bottom-[-150px] left-[95%] text-[45px] text-orange-500 animate-rise" style="animation-duration: 21s;">â‚«</div>
    </div>

    <!-- Header & Theme Switcher -->
    <header class="pt-8 pb-4 px-5 relative shrink-0">
        <div class="max-w-4xl mx-auto flex flex-col items-center">
            <!-- BREADCRUMBS -->
            <nav class="breadcrumb">
                <a href="index.html" class="hover:text-primary">Home</a>
                <i class="fas fa-chevron-right text-[8px]"></i>
                <span class="hover:text-primary cursor-pointer">CMA MCQ</span>
                <i class="fas fa-chevron-right text-[8px]"></i>
                <span class="text-primary">Paper 7</span>
            </nav>

            <div class="w-20 h-20 md:w-28 md:h-28 mx-auto mb-4 cursor-pointer transition-transform hover:scale-110 animate-floating" onclick="location.href='index.html'">
                <img src="prep.png" alt="Prepogy Logo" class="w-full h-auto object-contain" onerror="this.src='https://via.placeholder.com/80?text=Logo'">
            </div>
            
            <div class="flex items-center gap-2 bg-black/5 p-1.5 rounded-2xl backdrop-blur-sm mb-4">
                <button onclick="setTheme('light')" id="theme-light" class="theme-btn" title="Light Mode">
                    <i class="fas fa-sun"></i>
                </button>
                <button onclick="setTheme('dark')" id="theme-dark" class="theme-btn" title="Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button onclick="setTheme('sepia')" id="theme-sepia" class="theme-btn" title="Sepia Mode">
                    <i class="fas fa-coffee"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow flex flex-col max-w-2xl mx-auto px-4 md:px-5 w-full">
        <!-- Top Nav -->
        <div id="quizHeader" class="flex justify-between items-center mb-6">
            <button class="btn-home" onclick="location.href='index.html'">
                <i class="fas fa-home"></i> <span class="hidden sm:inline">Home</span>
            </button>
            <div class="flex items-center gap-2 sm:gap-3">
                <button onclick="location.reload()" class="text-[10px] text-red-500 font-bold uppercase tracking-wide px-2 py-1">Reset</button>
                <select id="setSelector" class="max-w-[120px] sm:max-w-[200px] rounded-xl px-3 py-2 text-xs font-bold border outline-none focus:border-primary cursor-pointer truncate" style="background-color: var(--color-surface); border-color: var(--color-border);">
                </select>
            </div>
        </div>

        <!-- Score Dashboard -->
        <div id="statsBar" class="bg-surface rounded-3xl p-5 flex shadow-soft mb-8 border border-slate-100/50 divide-x divide-slate-100/10 animate-fade-in-up">
            <div class="flex-1 text-center">
                <span class="block text-2xl font-extrabold text-success mb-1" id="scoreCorrect">0</span>
                <span class="text-[9px] font-bold opacity-60 uppercase tracking-widest">Correct</span>
            </div>
            <div class="flex-1 text-center">
                <span class="block text-2xl font-extrabold text-error mb-1" id="scoreWrong">0</span>
                <span class="text-[9px] font-bold opacity-60 uppercase tracking-widest">Wrong</span>
            </div>
            <div class="flex-1 text-center">
                <span class="block text-2xl font-extrabold text-primary mb-1" id="scoreAcc">0%</span>
                <span class="text-[9px] font-bold opacity-60 uppercase tracking-widest">Accuracy</span>
            </div>
        </div>

        <!-- Quiz Container -->
        <article id="questionArea" class="bg-surface backdrop-blur-md shadow-soft rounded-[2.5rem] p-6 md:p-10 relative overflow-hidden transition-all duration-300 animate-fade-in-up">
            <i class="fas fa-puzzle-piece absolute -bottom-8 -right-8 text-[12rem] text-primary opacity-[0.03] -rotate-12 pointer-events-none"></i>
            
            <div id="questionContent" class="animate-slide-in">
                <p id="qIndexDisplay" class="text-[11px] font-bold text-primary uppercase mb-5 tracking-[0.2em]"></p>
                <h1 id="qTextDisplay" class="text-xl md:text-2xl font-bold mb-8 leading-tight">Loading CMA Intermediate Paper 7 MCQs...</h1>
                
                <div id="optionsContainer" class="space-y-4" role="radiogroup" aria-labelledby="qTextDisplay"></div>

                <div id="explanationContainer" class="mt-8 p-6 bg-black/5 rounded-3xl border-l-4 border-primary hidden animate-fade-in-up">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="text-xs font-bold uppercase text-primary tracking-wide">Explanation</h4>
                        <button onclick="openGoogleSearch()" class="relative p-[1.5px] rounded-full overflow-hidden inline-flex items-center justify-center cursor-pointer transition-transform hover:scale-105 group border-none bg-transparent">
                            <div class="absolute inset-0 bg-[conic-gradient(from_0deg,#4285f4,#34a853,#fbbc05,#ea4335,#4285f4)] animate-rotate-border"></div>
                            <div class="relative bg-white px-3 py-1.5 rounded-full flex items-center gap-1.5 z-10">
                                <i class="fas fa-magnifying-glass-chart text-primary text-xs"></i>
                                <span class="font-bold text-[10px] text-slate-600">ASK GURU <span class="google-g-text">G</span></span>
                            </div>
                        </button>
                    </div>
                    <p id="explanationText" class="text-sm opacity-80 leading-relaxed italic"></p>
                </div>
            </div>

            <div class="flex justify-between mt-10 pt-8 border-t border-black/5">
                <button id="btnPrevQ" class="px-7 py-3.5 rounded-2xl font-bold transition-all flex items-center gap-2 bg-black/5 hover:bg-black/10 disabled:opacity-0 active:scale-95" onclick="changeQuestion(-1)">
                    <i class="fas fa-chevron-left"></i> Prev
                </button>
                <button id="btnNextQ" class="px-7 py-3.5 rounded-2xl font-bold transition-all flex items-center gap-2 bg-primary text-white shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50 active:scale-95" onclick="changeQuestion(1)">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </article>

        <!-- Completion Page -->
        <div id="resultsArea" class="hidden bg-surface rounded-[32px] p-8 md:p-12 text-center shadow-2xl animate-fade-in-up border border-slate-100/10 relative overflow-hidden">
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-indigo-50 rounded-full opacity-50"></div>
            
            <div class="relative z-10">
                <div class="w-24 h-24 bg-gradient-to-tr from-indigo-500 to-primary text-white rounded-[2rem] flex items-center justify-center text-4xl mx-auto mb-6 shadow-xl animate-floating">
                    <i class="fas fa-trophy"></i>
                </div>
                
                <h2 class="text-3xl font-black text-slate-800 mb-2">Quiz Completed!</h2>
                <div id="finalScoreDisplay" class="inline-block bg-indigo-50 text-primary px-6 py-2 rounded-full font-extrabold text-sm mb-8 tracking-wide"></div>
                
                <div class="mb-8 p-6 bg-black/5 rounded-[28px] border border-black/5">
                    <div class="flex items-center justify-center gap-2 mb-3">
                        <i class="fas fa-heart text-rose-500 animate-pulse text-sm"></i>
                        <h4 class="text-xs font-bold uppercase tracking-widest opacity-50">Support our Community</h4>
                    </div>
                    <p class="text-sm font-medium opacity-80 leading-relaxed mb-6">
                        "Your contribution helps us keep this platform free and updated for every CMA aspirant. If you found this helpful, kindly share it with your study groups."
                    </p>
                    
                    <div class="bg-surface p-6 rounded-2xl shadow-sm border-l-4 border-primary text-left relative">
                        <i class="fas fa-quote-left absolute top-4 left-4 text-primary opacity-10 text-xl"></i>
                        <p id="quoteDisplay" class="text-sm font-bold text-indigo-900 leading-relaxed italic relative z-10"></p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <button onclick="shareToWhatsApp()" class="share-btn bg-gradient-to-r from-emerald-500 to-green-600 shadow-emerald-100">
                        <i class="fab fa-whatsapp text-lg"></i> WhatsApp
                    </button>
                    <button onclick="shareToTelegram()" class="share-btn bg-gradient-to-r from-sky-500 to-blue-600 shadow-blue-100">
                        <i class="fab fa-telegram-plane text-lg"></i> Telegram
                    </button>
                    <button onclick="copyResultLink()" class="col-span-2 share-btn bg-slate-800 shadow-slate-200">
                        <i class="fas fa-link"></i> Copy Referral Link
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-6 border-t border-black/5">
                    <button onclick="location.reload()" class="py-4 rounded-2xl font-bold text-sm bg-primary text-white shadow-lg shadow-indigo-100 hover:bg-primary-dark transition-all">
                        Try Again
                    </button>
                    <button onclick="location.href='index.html'" class="py-4 rounded-2xl font-bold text-sm bg-black/5 text-slate-500 hover:bg-black/10 transition-all">
                        Main Menu
                    </button>
                </div>
                
                <div id="copyFeedback" class="absolute bottom-24 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-4 py-2 rounded-full text-[10px] font-bold uppercase tracking-widest hidden animate-fade-in-up">
                    Copied to Clipboard!
                </div>
            </div>
        </div>
    </main>

    <footer class="py-12 text-center opacity-40">
        <p class="text-[10px] font-black uppercase tracking-[0.5em]">Prepogy Â© 2025</p>
    </footer>

    <script>
        let currentSetIdx = 0;
        let currentQIdx = 0;
        let score = { c: 0, w: 0 };
        let userAnswers = [];
        let questionsAttempted = [];
        let touchStartX = 0;

        const qIndexEl = document.getElementById('qIndexDisplay');
        const qTextEl = document.getElementById('qTextDisplay');
        const optionsEl = document.getElementById('optionsContainer');
        const nextBtn = document.getElementById('btnNextQ');
        const prevBtn = document.getElementById('btnPrevQ');
        const setSelector = document.getElementById('setSelector');
        const explanationBox = document.getElementById('explanationContainer');
        const explanationText = document.getElementById('explanationText');
        const questionContent = document.getElementById('questionContent');

        const performanceQuotes = [
            "âš ï¸ Help us stay online! Share this link with just one friend today.",
            "ðŸš€ Small acts lead to big impacts. Sharing fuels months of practice for CMAs.",
            "ðŸ™ A Personal Request: We're a tiny team. Your share is our only marketing.",
            "ðŸ“¢ Spread the Word! Recommend us to a peer today.",
            "ðŸ†˜ We Need You! Please share this platform to keep it free.",
            "ðŸ° Strong communities share resources. Post this link and strengthen our network."
        ];

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            const btn = document.getElementById(`theme-${theme}`);
            if(btn) btn.classList.add('active');
            localStorage.setItem('quiz-theme', theme);
        }

        function initQuiz() {
            const savedTheme = localStorage.getItem('quiz-theme') || 'light';
            setTheme(savedTheme);

            if (typeof quizSets === 'undefined') {
                qTextEl.textContent = "Error: Database not found.";
                return;
            }
            setSelector.innerHTML = quizSets.map((set, i) => `<option value="${i}">${set.setName}</option>`).join('');
            setSelector.onchange = (e) => loadSet(parseInt(e.target.value));
            loadSet(0);
            initGestures();
        }

         function initGestures() {
            const area = document.getElementById('questionArea');
            area.addEventListener('touchstart', (e) => { 
                // Only track start if single finger and NOT zoomed in
                if (e.touches.length === 1 && (!window.visualViewport || window.visualViewport.scale === 1)) {
                    touchStartX = e.changedTouches[0].clientX; 
                } else {
                    touchStartX = null; 
                }
            }, { passive: true });
            
            area.addEventListener('touchend', (e) => {
                if (touchStartX === null) return;
                
                // Prevent navigation if the user is currently zoomed in (likely panning)
                if (window.visualViewport && window.visualViewport.scale > 1) {
                    touchStartX = null;
                    return;
                }

                const diffX = touchStartX - e.changedTouches[0].clientX;
                // Threshold of 60px sensitivity
                if (Math.abs(diffX) > 60) { 
                    if (diffX > 0) changeQuestion(1); 
                    else changeQuestion(-1); 
                }
                touchStartX = null;
            }, { passive: true });
        }

        function loadSet(idx) {
            currentSetIdx = idx;
            currentQIdx = 0;
            score = { c: 0, w: 0 };
            const questions = quizSets[currentSetIdx].questions;
            userAnswers = new Array(questions.length).fill(null);
            questionsAttempted = new Array(questions.length).fill(false);
            
            document.getElementById('resultsArea').classList.add('hidden');
            document.getElementById('questionArea').classList.remove('hidden');
            document.getElementById('statsBar').classList.remove('hidden');
            document.getElementById('quizHeader').classList.remove('hidden');
            
            updateStats();
            renderQuestion();
        }

        function renderQuestion() {
            const set = quizSets[currentSetIdx].questions;
            const q = set[currentQIdx];
            
            qIndexEl.textContent = `Progress â€¢ ${currentQIdx + 1} of ${set.length}`;
            qTextEl.textContent = q.q;
            optionsEl.innerHTML = '';
            
            q.o.forEach((opt, i) => {
                const div = document.createElement('div');
                div.className = 'option';
                div.setAttribute('role', 'radio');
                
                const isSelected = userAnswers[currentQIdx] === opt;
                div.setAttribute('aria-checked', isSelected ? 'true' : 'false');
                
                if (questionsAttempted[currentQIdx]) {
                    div.classList.add('disabled');
                    if (opt === q.c) div.classList.add('correct');
                    if (isSelected && opt !== q.c) div.classList.add('incorrect');
                } else {
                    div.onclick = () => handleAnswer(opt, div);
                }
                
                div.innerHTML = `
                    <span class="w-10 h-10 rounded-xl bg-black/5 flex items-center justify-center font-bold mr-5 shrink-0 transition-colors">
                        ${String.fromCharCode(65 + i)}
                    </span>
                    <span class="text-[15px] font-semibold opacity-90">${opt}</span>
                `;
                optionsEl.appendChild(div);
            });

            if (questionsAttempted[currentQIdx]) {
                explanationBox.classList.remove('hidden');
                explanationText.textContent = "Reference: Official CMA Study Material.";
            } else {
                explanationBox.classList.add('hidden');
            }

            prevBtn.style.visibility = (currentQIdx === 0) ? 'hidden' : 'visible';
            nextBtn.innerHTML = (currentQIdx === set.length - 1) ? 'Show Results' : 'Next Question <i class="fas fa-chevron-right ml-1"></i>';
        }

        function handleAnswer(selected, element) {
            if (questionsAttempted[currentQIdx]) return;
            
            const correct = quizSets[currentSetIdx].questions[currentQIdx].c;
            questionsAttempted[currentQIdx] = true;
            userAnswers[currentQIdx] = selected;
            
            element.classList.add('animate-pop');

            if (selected === correct) {
                score.c++;
                createConfetti(15); 
            } else {
                score.w++;
            }
            
            updateStats();
            setTimeout(renderQuestion, 200);
        }

        function updateStats() {
            const total = score.c + score.w;
            const acc = total > 0 ? Math.round((score.c / total) * 100) + '%' : '0%';
            document.getElementById('scoreCorrect').textContent = score.c;
            document.getElementById('scoreWrong').textContent = score.w;
            document.getElementById('scoreAcc').textContent = acc;
        }

        function changeQuestion(dir) {
            const set = quizSets[currentSetIdx].questions;
            const next = currentQIdx + dir;
            
            if (next >= 0 && next < set.length) {
                questionContent.classList.remove('animate-slide-in');
                void questionContent.offsetWidth; 
                questionContent.classList.add('animate-slide-in');
                
                currentQIdx = next; 
                renderQuestion(); 
            } else if (next >= set.length) {
                showResults();
            }
        }

        function createConfetti(count = 60) {
            const colors = ['#6366f1', '#10b981', '#f59e0b', '#db2777', '#0ea5e9'];
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.className = 'confetti-particle';
                p.style.left = Math.random() * 100 + 'vw';
                p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                p.style.animationDelay = Math.random() * 0.5 + 's';
                p.style.width = Math.random() * 8 + 4 + 'px';
                p.style.height = p.style.width;
                p.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 3000);
            }
        }

        function showResults() {
            document.getElementById('questionArea').classList.add('hidden');
            document.getElementById('statsBar').classList.add('hidden');
            document.getElementById('quizHeader').classList.add('hidden');
            
            const res = document.getElementById('resultsArea');
            res.classList.remove('hidden');
            
            const total = quizSets[currentSetIdx].questions.length;
            document.getElementById('finalScoreDisplay').textContent = `Correct: ${score.c} out of ${total}`;
            
            const quote = performanceQuotes[Math.floor(Math.random() * performanceQuotes.length)];
            document.getElementById('quoteDisplay').textContent = quote;

            createConfetti(100);
        }

        function shareToWhatsApp() {
            const total = quizSets[currentSetIdx].questions.length;
            const text = encodeURIComponent(`I scored ${score.c}/${total} on Prepogy CMA Quiz! ðŸš€ Try it yourself: ${window.location.href}`);
            window.open(`https://wa.me/?text=${text}`, '_blank');
        }

        function shareToTelegram() {
            const total = quizSets[currentSetIdx].questions.length;
            const text = encodeURIComponent(`I scored ${score.c}/${total} on Prepogy CMA Quiz! ðŸš€`);
            const url = encodeURIComponent(window.location.href);
            window.open(`https://t.me/share/url?url=${url}&text=${text}`, '_blank');
        }

        function copyResultLink() {
            const total = quizSets[currentSetIdx].questions.length;
            const textToCopy = `I scored ${score.c}/${total} on Prepogy CMA Quiz! Practice here: ${window.location.href}`;
            const temp = document.createElement("input");
            temp.value = textToCopy;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand("copy");
            document.body.removeChild(temp);
            const fb = document.getElementById('copyFeedback');
            fb.classList.remove('hidden');
            setTimeout(() => fb.classList.add('hidden'), 3000);
        }

        function openGoogleSearch() {
            const q = quizSets[currentSetIdx].questions[currentQIdx];
            const query = `Explain why "${q.c}" is correct for: ${q.q}`;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('resultsArea').classList.contains('hidden')) {
                const key = e.key.toLowerCase();
                const map = { 'a': 0, 'b': 1, 'c': 2, 'd': 3, '1': 0, '2': 1, '3': 2, '4': 3 };
                if (key in map) {
                    const opts = optionsEl.children;
                    if (opts[map[key]]) opts[map[key]].click();
                } else if (key === 'enter' || key === 'arrowright') {
                    changeQuestion(1);
                } else if (key === 'arrowleft') {
                    changeQuestion(-1);
                }
            }
        });

        window.onload = initQuiz;
    </script>
</body>

</html>
